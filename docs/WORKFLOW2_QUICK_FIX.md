# å·¥ä½œæµ2 ä¿å­˜å¤±è´¥ - å¿«é€Ÿä¿®å¤ (5 åˆ†é’Ÿ)

## ğŸ”´ é—®é¢˜æ¦‚è§ˆ

```
å·¥ä½œæµ2 ä¿å­˜å¤±è´¥: save_status = "å¤±è´¥"
æ ¹æœ¬åŸå› : POST è·¯å¾„ç¼ºå°‘ sessionId
```

---

## âœ… ç«‹å³ä¿®å¤ (3 æ­¥)

### Step 1: éªŒè¯å­˜å‚¨æœåŠ¡è¿è¡Œ (1 åˆ†é’Ÿ)

```bash
curl https://phrenologic-preprandial-jesica.ngrok-free.dev/health
```

**æœŸæœ›è¿”å›**:
```json
{"status": "ok"}
```

**å¦‚æœå¤±è´¥ï¼Œå¯åŠ¨æœåŠ¡**:
```bash
node D:\code7\interview-system\storage-service-nodejs.js
```

---

### Step 2: åœ¨ Dify å¹³å°ä¿®æ”¹å·¥ä½œæµ2 (3 åˆ†é’Ÿ)

1. **æ‰“å¼€å·¥ä½œæµ2**
   - ç™»å½•: https://cloud.dify.ai
   - æ‰¾åˆ°: "AIé¢è¯•å®˜-å·¥ä½œæµ2-ç”Ÿæˆç­”æ¡ˆ"
   - ç‚¹å‡»: ç¼–è¾‘

2. **æ‰¾åˆ°ä¿å­˜èŠ‚ç‚¹**
   - åœ¨ç¼–è¾‘å™¨ä¸­æ‰¾åˆ°: `save_standard_answer` (Pythonä»£ç èŠ‚ç‚¹)
   - å³ä¾§ä¼šæ˜¾ç¤ºä»£ç 

3. **æ‰¾åˆ°è¿™è¡Œä»£ç ** (å¤§çº¦ç¬¬313è¡Œ):
   ```python
   post_req = urllib.request.Request(
       api_base_url,  # â† è¿™é‡Œæ˜¯é—®é¢˜
   ```

4. **æ”¹ä¸º**:
   ```python
   post_req = urllib.request.Request(
       f"{api_base_url}/{session_id}",  # â† æ·»åŠ  /{session_id}
   ```

5. **ä¿å­˜å¹¶å‘å¸ƒ**
   - ç‚¹å‡»ä¿å­˜ (Ctrl+S)
   - ç‚¹å‡»å‘å¸ƒæŒ‰é’®
   - ç­‰å¾…ç»¿è‰²æˆåŠŸæç¤º

---

### Step 3: éªŒè¯ä¿®å¤ (1 åˆ†é’Ÿ)

```bash
cd D:\code7\interview-system
node test-workflows-with-mcp.js
```

**æœŸæœ›çœ‹åˆ°**:
```
å·¥ä½œæµ2 - ç”Ÿæˆç­”æ¡ˆ: âœ… æˆåŠŸ
   â””â”€ save_status: "æˆåŠŸ"  â† è¿™ä¸ªåº”è¯¥ä»"å¤±è´¥"å˜æˆ"æˆåŠŸ"
```

---

## ğŸ¯ ä¸ºä»€ä¹ˆè¿™æ ·ä¿®å¤

**åŸå› **:

å­˜å‚¨æœåŠ¡æœ‰ä¸¤ç§ POST æ–¹å¼:

```
âŒ POST /api/sessions
   â†’ åˆ›å»ºæ–°ä¼šè¯
   â†’ ä¸é€‚åˆå·¥ä½œæµ2ï¼ˆéœ€è¦æ›´æ–°ç°æœ‰ä¼šè¯ï¼‰

âœ… POST /api/sessions/{sessionId}
   â†’ æ›´æ–°ç°æœ‰ä¼šè¯
   â†’ è¿™æ˜¯å·¥ä½œæµ2éœ€è¦çš„
```

å·¥ä½œæµ2çš„é€»è¾‘æ˜¯ï¼š
```python
# 1. è·å–ç°æœ‰ä¼šè¯
session_data = GET(/api/sessions/{sessionId})

# 2. ä¿®æ”¹ä¼šè¯ä¸­çš„é—®é¢˜ç­”æ¡ˆ
session_data['questions'][0]['answer'] = "æ–°ç­”æ¡ˆ"

# 3. å‘é€å›å» â† è¿™é‡Œéœ€è¦æŒ‡å®š sessionId
POST(/api/sessions/{sessionId}, session_data)
```

---

## ğŸ“Š ä¿®å¤ç»“æœå¯¹æ¯”

### ä¿®å¤å‰
```
å·¥ä½œæµ2 æ‰§è¡Œ:
  Step 1: è·å–ä¼šè¯ âœ…
  Step 2: ä¿®æ”¹ç­”æ¡ˆ âœ…
  Step 3: ä¿å­˜åˆ°æœåŠ¡å™¨
         POST /api/sessions  âŒ é”™è¯¯è·¯å¾„
         â””â”€ å­˜å‚¨æœåŠ¡åˆ›å»ºæ–°ä¼šè¯è€Œä¸æ˜¯æ›´æ–°
         â””â”€ åŸä¼šè¯æœªè¢«æ›´æ–°
         â””â”€ save_status = "å¤±è´¥"
```

### ä¿®å¤å
```
å·¥ä½œæµ2 æ‰§è¡Œ:
  Step 1: è·å–ä¼šè¯ âœ…
  Step 2: ä¿®æ”¹ç­”æ¡ˆ âœ…
  Step 3: ä¿å­˜åˆ°æœåŠ¡å™¨
         POST /api/sessions/{sessionId}  âœ… æ­£ç¡®è·¯å¾„
         â””â”€ å­˜å‚¨æœåŠ¡æ›´æ–°ç°æœ‰ä¼šè¯
         â””â”€ ç­”æ¡ˆè¢«ä¿å­˜
         â””â”€ save_status = "æˆåŠŸ"
```

---

## ğŸ’¡ å…¶ä»–å¯èƒ½çš„é—®é¢˜ (å¦‚æœè¿˜æ˜¯å¤±è´¥)

### é—®é¢˜ A: å­˜å‚¨æœåŠ¡æœªè¿è¡Œ

**ç—‡çŠ¶**: `Connection refused` æˆ– `502 Bad Gateway`

**è§£å†³**:
```bash
# å¯åŠ¨å­˜å‚¨æœåŠ¡
node D:\code7\interview-system\storage-service-nodejs.js

# éªŒè¯
curl https://phrenologic-preprandial-jesica.ngrok-free.dev/health
```

### é—®é¢˜ B: Ngrok éš§é“åœ°å€æ”¹å˜äº†

**ç—‡çŠ¶**: è¿æ¥è¶…æ—¶æˆ– 404

**è§£å†³**:
1. æ£€æŸ¥ Ngrok éš§é“å½“å‰åœ°å€
2. æ›´æ–°å·¥ä½œæµ2ä¸­çš„ `api_base_url`
3. é‡æ–°å‘å¸ƒ

### é—®é¢˜ C: API å¯†é’¥ä¸åŒ¹é…

**ç—‡çŠ¶**: `HTTP 401 Unauthorized`

**è§£å†³**:
1. åœ¨å­˜å‚¨æœåŠ¡æ£€æŸ¥ API_KEY
2. æ›´æ–°å·¥ä½œæµ2ä¸­çš„ `api_key`

### é—®é¢˜ D: è¶…æ—¶

**ç—‡çŠ¶**: `Connection timeout` æˆ– `Socket timeout`

**è§£å†³**:
1. åœ¨å·¥ä½œæµ2ä¸­æ‰¾åˆ° `timeout=10`
2. æ”¹ä¸º `timeout=30`
3. é‡æ–°å‘å¸ƒ

---

## â±ï¸ é¢„è®¡æ—¶é—´

- éªŒè¯å­˜å‚¨æœåŠ¡: 1 åˆ†é’Ÿ
- Dify å¹³å°ä¿®æ”¹: 3 åˆ†é’Ÿ
- éªŒè¯æµ‹è¯•: 1 åˆ†é’Ÿ
- **æ€»è®¡: 5 åˆ†é’Ÿ**

---

## âœ… å®Œæˆæ£€æŸ¥è¡¨

ä¿®å¤å‰:
- [ ] å·²è¯»è¿™ä¸ªæŒ‡å—
- [ ] å·²éªŒè¯å­˜å‚¨æœåŠ¡è¿è¡Œ
- [ ] å·²æ‰“å¼€å·¥ä½œæµ2ç¼–è¾‘é¡µé¢

ä¿®å¤ä¸­:
- [ ] å·²æ‰¾åˆ° `save_standard_answer` èŠ‚ç‚¹
- [ ] å·²æ‰¾åˆ° POST ä»£ç è¡Œ
- [ ] å·²æ”¹ä¸º `f"{api_base_url}/{session_id}"`
- [ ] å·²ä¿å­˜
- [ ] å·²ç‚¹å‡»å‘å¸ƒ

ä¿®å¤å:
- [ ] å·¥ä½œæµ2 å‘å¸ƒæˆåŠŸ (ç»¿è‰²æç¤º)
- [ ] è¿è¡Œæµ‹è¯•è„šæœ¬æˆåŠŸ
- [ ] `save_status` = "æˆåŠŸ"

---

## ğŸ“ ç›¸å…³æ–‡ä»¶

- **è¯¦ç»†è¯Šæ–­**: `WORKFLOW2_DETAILED_DIAGNOSIS.md`
- **å·¥ä½œæµ2æ–‡ä»¶**: `D:\code7\test5\AIé¢è¯•å®˜-å·¥ä½œæµ2-ç”Ÿæˆç­”æ¡ˆ (5).yml`
- **æµ‹è¯•è„šæœ¬**: `test-workflows-with-mcp.js`

---

**é—®é¢˜**: POST è·¯å¾„å°‘äº† `{sessionId}`
**è§£å†³**: æ·»åŠ  `/{session_id}` åˆ° URL
**æ—¶é—´**: 5 åˆ†é’Ÿ
**æ•ˆæœ**: save_status ä»"å¤±è´¥"å˜æˆ"æˆåŠŸ"

