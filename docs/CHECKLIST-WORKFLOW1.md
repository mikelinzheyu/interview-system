# 工作流1 配置检查清单

## 📋 工作流配置信息

✅ 已更新为新的配置：

```
工作流名称: AI面试官 - 工作流1 - 生成问题
公开访问 URL: https://udify.app/workflow/gBlbo69soxLoTRSO
API 密钥: app-Ennx2JM19l6SuL2kS4hShPGG
API 端点: https://api.dify.ai/v1/workflows/run
服务端点: https://api.dify.ai/mcp/server/w6Nhg28umyahIzsw/mcp
```

---

## 🔍 Dify 工作流界面检查

访问: https://udify.app/workflow/gBlbo69soxLoTRSO

### 工作流基本设置
- [ ] 工作流名称正确显示
- [ ] 工作流已发布 (Published 状态)
- [ ] 没有错误警告标志

### 工作流节点检查
- [ ] **开始节点** - 包含 `job_title` 输入参数
- [ ] **职位信息搜索节点** - Google 搜索工具已启用
- [ ] **提取技能并生成问题节点** - LLM 模型已配置 (Gemini)
- [ ] **保存问题列表节点** - Python 代码节点正常
- [ ] **输出节点** - 包含所有输出字段

### 工作流连接检查
- [ ] start → search_job (正确连接)
- [ ] search_job → extract_skills (正确连接)
- [ ] extract_skills → save_questions (正确连接)
- [ ] save_questions → end_output (正确连接)
- [ ] 没有断开的连接

### 变量映射检查
- [ ] **questions 变量**: `extract_skills → structured_output → questions`
- [ ] **job_title 变量**: `start → job_title`
- [ ] 变量类型正确设置
- [ ] 没有缺失的变量引用

---

## 🧪 测试验证

### 在 Dify 中直接运行工作流

1. **打开工作流**
   - [ ] 访问: https://udify.app/workflow/gBlbo69soxLoTRSO
   - [ ] 工作流界面正确加载

2. **点击运行按钮**
   - [ ] "运行" 或 "测试" 按钮可见
   - [ ] 能够点击运行

3. **输入测试数据**
   - [ ] 输入: `Python后端开发工程师`
   - [ ] 点击 "提交" 或 "运行"

4. **观察执行过程**
   - [ ] 工作流开始执行
   - [ ] 可以看到各节点的执行状态
   - [ ] 没有红色错误标志

5. **检查输出结果**
   - [ ] 收到有效的 session_id
   - [ ] 返回了 5 个问题
   - [ ] job_title 正确显示
   - [ ] question_count 为 5

### 运行测试脚本

```bash
# 简化测试
node test-workflow1-simple.js

# 预期结果
✅ HTTP 状态: 200
✅ session_id: 有效的 UUID
✅ questions: 包含 5 个问题
✅ job_title: Python后端开发工程师
✅ question_count: 5
```

### 检查存储服务

```bash
# 1. 存储服务是否运行
curl http://localhost:8080/actuator/health

# 预期结果
{
  "status": "UP",
  "sessions": 0
}

# 2. 检查会话是否保存
# 运行工作流1后检查
curl -H "Authorization: Bearer ak_live_a1b2c3d4e5f6a7b8c9d0e1f2a3b4c5d6e7f8a9b0" \
     http://localhost:8080/actuator/health
```

---

## ⚠️ 常见问题检查

### 如果返回 504 错误

- [ ] 工作流是否已发布?
- [ ] 是否需要重新保存工作流?
- [ ] 所有依赖是否已安装?
- [ ] 网络连接是否正常?
- [ ] API 速率限制是否超过?

**解决方案**:
1. 在 Dify 中重新发布工作流
2. 等待 5-10 分钟后重试
3. 检查 Dify 服务状态

### 如果返回 401 错误

- [ ] API 密钥是否正确: `app-Ennx2JM19l6SuL2kS4hShPGG`
- [ ] API 密钥是否已过期?
- [ ] 是否有权限访问该工作流?

**解决方案**:
1. 验证 API 密钥是否正确
2. 生成新的 API 密钥
3. 检查账户权限

### 如果返回空的 questions

- [ ] Google 搜索是否返回结果?
- [ ] LLM 模型是否正确配置?
- [ ] 提示词是否有问题?

**解决方案**:
1. 检查 Google 搜索工具配置
2. 验证 Gemini API 密钥
3. 查看工作流执行日志

---

## 📊 性能指标检查

运行工作流后，检查以下指标：

- [ ] **执行时间**: 10-30 秒 (正常范围)
- [ ] **使用令牌数**: 合理范围内
- [ ] **错误数**: 0 个错误
- [ ] **警告数**: 0 个警告或可接受的警告

---

## 🔧 配置更新记录

| 日期 | 更新项 | 状态 |
|------|--------|------|
| 2025-10-16 | API 密钥更新 | ✅ 完成 |
| 2025-10-16 | 工作流 URL 更新 | ✅ 完成 |
| 2025-10-16 | 服务端点更新 | ✅ 完成 |
| 2025-10-16 | 测试脚本更新 | ✅ 完成 |

---

## 📝 执行记录

### 测试日期: 2025-10-16

| 测试项 | 结果 | 备注 |
|--------|------|------|
| API 连接 | 504 Error | 需要调查 |
| 工作流 URL | ✅ 可访问 | https://udify.app/workflow/gBlbo69soxLoTRSO |
| 存储服务 | ✅ 运行中 | http://localhost:8080 |
| 前后端 | ✅ 运行中 | http://localhost:5174 |

---

## 🚀 后续行动

### 立即需要做的事

1. **验证工作流状态**
   - [ ] 访问工作流 URL
   - [ ] 检查工作流是否已发布
   - [ ] 查看是否有错误提示

2. **在 Dify 中测试**
   - [ ] 打开工作流
   - [ ] 手动运行一次
   - [ ] 检查输出结果

3. **检查错误日志**
   - [ ] 查看 Dify 工作流执行日志
   - [ ] 检查 504 错误的具体原因
   - [ ] 记录错误信息

4. **必要时重新发布**
   - [ ] 如果未发布，请发布工作流
   - [ ] 如果已发布，尝试重新保存并发布

---

## 💡 建议

### 如果继续遇到 504 错误

1. **简化工作流**
   - 暂时禁用某些功能测试
   - 检查哪个节点导致问题

2. **增加超时时间**
   - 检查是否可以增加工作流的超时配置

3. **联系支持**
   - 提供工作流 URL 和 API 密钥
   - 提供 504 错误的时间戳
   - 请求 Dify 团队帮助调查

---

## ✅ 最终确认

在所有检查都通过后，确认：

- [ ] 工作流1 配置信息已更新
- [ ] Dify 工作流界面显示正确
- [ ] 测试脚本能够正确调用工作流
- [ ] 工作流返回期望的结果
- [ ] 数据正确保存到存储服务

**状态**: 🟡 等待进一步调试

**问题**: 504 Gateway Timeout - 需要在 Dify 中验证

**下一步**: 按照上述检查清单逐项验证，并根据结果采取相应的故障排除措施。
