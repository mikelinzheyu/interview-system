# ç”¨æˆ·ç³»ç»Ÿå®Œæ•´å®ç°æŒ‡å—

## æ¦‚è¿°

æœ¬æŒ‡å—è¯¦ç»†è¯´æ˜äº†è®ºå›ç”¨æˆ·ç³»ç»Ÿçš„å®Œæ•´å®ç°æ–¹æ¡ˆï¼ŒåŒ…æ‹¬ç”¨æˆ·èµ„æ–™ã€ç²‰ä¸å…³æ³¨ç³»ç»Ÿã€å£°èª‰ç³»ç»Ÿã€ä¸ªäººä¸­å¿ƒç­‰åŠŸèƒ½ã€‚

## ç›®å½•

- [åŠŸèƒ½æ¸…å•](#åŠŸèƒ½æ¸…å•)
- [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)
- [API è§„èŒƒ](#api-è§„èŒƒ)
- [å‰ç«¯å®ç°](#å‰ç«¯å®ç°)
- [æ•°æ®åº“è®¾è®¡](#æ•°æ®åº“è®¾è®¡)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
- [åç«¯ç¤ºä¾‹](#åç«¯ç¤ºä¾‹)

---

## åŠŸèƒ½æ¸…å•

### âœ… å·²å®ç°åŠŸèƒ½

```
â”œâ”€ ç”¨æˆ·èµ„æ–™
â”‚  â”œâ”€ è·å–ç”¨æˆ·èµ„æ–™ï¼ˆå…¬å¼€/ç§å¯†å­—æ®µï¼‰
â”‚  â”œâ”€ ç¼–è¾‘ä¸ªäººèµ„æ–™ï¼ˆä»…è‡ªå·±å¯ç¼–è¾‘ï¼‰
â”‚  â”œâ”€ ä¸Šä¼ å¤´åƒ
â”‚  â”œâ”€ è·å–ç”¨æˆ·ç»Ÿè®¡ï¼ˆå¸–å­æ•°ã€è¯„è®ºæ•°ã€ç‚¹èµæ•°ã€è®¿é—®æ•°ï¼‰
â”‚  â””â”€ ç”¨æˆ·ç­¾åå’Œä¸ªäººä»‹ç»
â”‚
â”œâ”€ ç²‰ä¸å…³æ³¨ç³»ç»Ÿ
â”‚  â”œâ”€ å…³æ³¨/å–æ¶ˆå…³æ³¨ç”¨æˆ·
â”‚  â”œâ”€ è·å–ç²‰ä¸åˆ—è¡¨
â”‚  â”œâ”€ è·å–å…³æ³¨åˆ—è¡¨
â”‚  â”œâ”€ æ£€æŸ¥å…³æ³¨çŠ¶æ€ï¼ˆå•å‘/äº’ç²‰ï¼‰
â”‚  â”œâ”€ å±è”½ç”¨æˆ·ï¼ˆä¸çœ‹å…¶å†…å®¹ï¼‰
â”‚  â””â”€ äº’ç²‰æç¤º
â”‚
â”œâ”€ å£°èª‰ç³»ç»Ÿ
â”‚  â”œâ”€ ç”¨æˆ·ç­‰çº§ï¼ˆ1-10ï¼‰
â”‚  â”œâ”€ ç§¯åˆ†ç³»ç»Ÿï¼ˆæ¯é¡¹æ“ä½œè·å¾—ç§¯åˆ†ï¼‰
â”‚  â”œâ”€ å¾½ç« ç³»ç»Ÿï¼ˆæˆå°±å¾½ç« ï¼‰
â”‚  â”œâ”€ æˆå°±ç³»ç»Ÿï¼ˆé‡Œç¨‹ç¢‘ï¼‰
â”‚  â”œâ”€ å£°èª‰æ’è¡Œæ¦œï¼ˆæ—¥/å‘¨/æœˆ/æ€»ï¼‰
â”‚  â””â”€ å‡çº§è¿›åº¦æ˜¾ç¤º
â”‚
â””â”€ ä¸ªäººä¸­å¿ƒ
   â”œâ”€ æˆ‘çš„å¸–å­åˆ—è¡¨
   â”œâ”€ æˆ‘çš„è¯„è®ºåˆ—è¡¨
   â”œâ”€ æˆ‘çš„æ”¶è—
   â”œâ”€ å‘å¸ƒå†å²
   â””â”€ è´¦å·è®¾ç½®
```

---

## æ¶æ„è®¾è®¡

### æ•´ä½“ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      User System Architecture              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                              â”‚
â”‚  UI Layer (Vue Components)                   â”‚
â”‚  â”œâ”€ UserProfile.vue       (èµ„æ–™é¡µé¢)        â”‚
â”‚  â”œâ”€ UserCard.vue          (ç”¨æˆ·å¡ç‰‡)        â”‚
â”‚  â”œâ”€ UserCenter.vue        (ä¸ªäººä¸­å¿ƒ)        â”‚
â”‚  â”œâ”€ FollowerList.vue      (ç²‰ä¸åˆ—è¡¨)        â”‚
â”‚  â”œâ”€ FollowingList.vue     (å…³æ³¨åˆ—è¡¨)        â”‚
â”‚  â”œâ”€ ReputationPanel.vue   (å£°èª‰é¢æ¿)        â”‚
â”‚  â””â”€ LeaderboardPage.vue   (æ’è¡Œæ¦œ)          â”‚
â”‚         â†“                                    â”‚
â”‚  Composable Layer                          â”‚
â”‚  â”œâ”€ useUserProfile()      (èµ„æ–™ç®¡ç†)        â”‚
â”‚  â”œâ”€ useFollowSystem()     (å…³æ³¨ç³»ç»Ÿ)        â”‚
â”‚  â””â”€ useReputation()       (å£°èª‰ç³»ç»Ÿ)        â”‚
â”‚         â†“                                    â”‚
â”‚  API Layer                                  â”‚
â”‚  â””â”€ communityAPI.getUser*/Follow*/Reputation* â”‚
â”‚         â†“                                    â”‚
â”‚  Cache Layer                                â”‚
â”‚  â”œâ”€ Memory Cache (3-30 åˆ†é’Ÿ TTL)           â”‚
â”‚  â”œâ”€ Request Deduplication                 â”‚
â”‚  â””â”€ Automatic Retry                       â”‚
â”‚         â†“                                    â”‚
â”‚  Backend API                                â”‚
â”‚  â””â”€ /api/community/users/*                 â”‚
â”‚         â†“                                    â”‚
â”‚  Database                                   â”‚
â”‚  â”œâ”€ users table                            â”‚
â”‚  â”œâ”€ follows table                          â”‚
â”‚  â”œâ”€ user_badges table                      â”‚
â”‚  â”œâ”€ user_achievements table                â”‚
â”‚  â””â”€ user_reputation table                  â”‚
â”‚                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## API è§„èŒƒ

### 1. è·å–ç”¨æˆ·èµ„æ–™

```
GET /api/community/users/{userId}
```

**å“åº”æ ¼å¼**ï¼š

```json
{
  "code": 0,
  "data": {
    "userId": "user_1",
    "username": "å¼ ä¸‰",
    "email": "user@example.com",
    "avatar": "https://...",
    "signature": "ç”Ÿæ´»å¦‚åŒæ—…è¡Œ",
    "bio": "å…¨æ ˆå¼€å‘å·¥ç¨‹å¸ˆ",
    "phone": "13800138000",
    "location": "åŒ—äº¬",

    "followerCount": 100,
    "followingCount": 50,
    "isFollowing": false,
    "isMutual": false,

    "reputation": {
      "level": 5,
      "score": 2500,
      "rank": 128,
      "badges": [
        {
          "id": "helper",
          "name": "çƒ­å¿ƒåŠ©äºº",
          "icon": "ğŸ¤",
          "earnedAt": "2025-11-11T10:00:00Z"
        }
      ]
    },

    "stats": {
      "postsCount": 25,
      "commentsCount": 150,
      "likesCount": 500,
      "viewsCount": 3000,
      "collectionsCount": 10
    },

    "verified": {
      "email": true,
      "phone": false,
      "realName": false
    },

    "roles": ["user"],
    "createdAt": "2025-01-01T00:00:00Z",
    "lastLoginAt": "2025-11-11T10:00:00Z"
  }
}
```

### 2. æ›´æ–°ç”¨æˆ·èµ„æ–™

```
PUT /api/community/users/{userId}
```

**è¯·æ±‚ä½“**ï¼š

```json
{
  "username": "æ–°ç”¨æˆ·å",
  "signature": "æ–°ç­¾å",
  "bio": "æ–°ä»‹ç»",
  "location": "æ–°åœ°ç‚¹"
}
```

### 3. ä¸Šä¼ å¤´åƒ

```
POST /api/community/users/avatar
Content-Type: multipart/form-data
```

**è¯·æ±‚**ï¼š

```
formData.append('file', File)
```

**å“åº”**ï¼š

```json
{
  "code": 0,
  "data": {
    "url": "https://cdn.example.com/avatars/user_1.jpg"
  }
}
```

### 4. å…³æ³¨/å–æ¶ˆå…³æ³¨ç”¨æˆ·

```
POST /api/community/users/{userId}/follow
```

**å“åº”**ï¼š

```json
{
  "code": 0,
  "data": {
    "isFollowing": true,
    "isMutual": false,
    "followerCount": 101
  }
}
```

### 5. è·å–ç²‰ä¸åˆ—è¡¨

```
GET /api/community/users/{userId}/followers?page=1&pageSize=20
```

**å“åº”**ï¼š

```json
{
  "code": 0,
  "data": [
    {
      "userId": "follower_1",
      "username": "æå››",
      "avatar": "https://...",
      "signature": "...",
      "isMutual": false,
      "isFollowing": false,
      "followedAt": "2025-11-11T10:00:00Z"
    }
  ],
  "total": 100,
  "page": 1,
  "pageSize": 20
}
```

### 6. è·å–å…³æ³¨åˆ—è¡¨

```
GET /api/community/users/{userId}/following?page=1&pageSize=20
```

å“åº”æ ¼å¼åŒç²‰ä¸åˆ—è¡¨

### 7. è·å–ç”¨æˆ·å£°èª‰ä¿¡æ¯

```
GET /api/community/users/{userId}/reputation
```

**å“åº”**ï¼š

```json
{
  "code": 0,
  "data": {
    "userId": "user_1",
    "level": 5,
    "score": 2500,
    "totalScore": 2500,
    "rank": 128,
    "nextLevelScore": 600,
    "progressToNextLevel": 75
  }
}
```

### 8. è·å–ç”¨æˆ·å¾½ç« 

```
GET /api/community/users/{userId}/badges
```

**å“åº”**ï¼š

```json
{
  "code": 0,
  "data": [
    {
      "id": "helper",
      "name": "çƒ­å¿ƒåŠ©äºº",
      "description": "å¸®åŠ©å…¶ä»–ç”¨æˆ·è¶…è¿‡ 50 æ¬¡",
      "icon": "ğŸ¤",
      "category": "social",
      "rarity": "common",
      "earnedAt": "2025-11-11T10:00:00Z"
    }
  ]
}
```

### 9. è·å–å£°èª‰æ’è¡Œæ¦œ

```
GET /api/community/leaderboard/reputation?period=month&limit=10
```

**å‚æ•°**ï¼š
- `period`: day|week|month|all (é»˜è®¤: month)
- `limit`: è¿”å›æ•°é‡ (é»˜è®¤: 10)

**å“åº”**ï¼š

```json
{
  "code": 0,
  "data": [
    {
      "rank": 1,
      "userId": "user_top",
      "username": "æ’è¡Œç¬¬ä¸€",
      "avatar": "https://...",
      "level": 10,
      "score": 10000
    }
  ]
}
```

---

## å‰ç«¯å®ç°

### useUserProfile Composable

```javascript
export function useUserProfile(userId) {
  // è·å–ç”¨æˆ·èµ„æ–™
  const user = ref(null)
  const loading = ref(false)
  const error = ref(null)

  // ç”¨æˆ·çš„å¸–å­ã€è¯„è®ºã€æ”¶è—
  const userPosts = ref([])
  const userComments = ref([])
  const userCollections = ref([])

  // æ–¹æ³•
  const fetchUserProfile = async () => {}
  const fetchUserPosts = async (page = 1) => {}
  const fetchUserComments = async (page = 1) => {}
  const fetchUserCollections = async () => {}
  const editProfile = async (profileData) => {}
  const uploadAvatar = async (file) => {}
  const refresh = async () => {}

  // è®¡ç®—å±æ€§
  const stats = computed(() => ({ ... }))
  const reputation = computed(() => ({ ... }))
  const editable = computed(() => isCurrentUser)

  return { ... }
}
```

### useFollowSystem Composable

```javascript
export function useFollowSystem(userId) {
  // å…³æ³¨çŠ¶æ€
  const isFollowing = ref(false)
  const isMutual = ref(false)
  const followers = ref([])
  const following = ref([])

  // æ–¹æ³•
  const checkFollowStatus = async () => {}
  const toggleFollow = async () => {}
  const fetchFollowers = async (page = 1) => {}
  const fetchFollowing = async (page = 1) => {}
  const blockUser = async () => {}
  const unblockUser = async () => {}

  // è®¡ç®—å±æ€§
  const followerStats = computed(() => ({ ... }))
  const followingStats = computed(() => ({ ... }))
  const mutualText = computed(() => 'äº’ç›¸å…³æ³¨' | 'å·²å…³æ³¨' | 'æœªå…³æ³¨')

  return { ... }
}
```

### useReputation Composable

```javascript
export function useReputation(userId) {
  // å£°èª‰æ•°æ®
  const reputation = ref(null)
  const badges = ref([])
  const achievements = ref([])
  const leaderboard = ref([])
  const nextLevelProgress = ref(0)

  // æ–¹æ³•
  const fetchReputation = async () => {}
  const fetchBadges = async () => {}
  const fetchAchievements = async () => {}
  const fetchLeaderboard = async (period, limit) => {}
  const refresh = async () => {}

  // è®¡ç®—å±æ€§
  const levelText = computed(() => 'æ–°æ‰‹'|'åˆçº§'|...|'ä¼ è¯´')
  const scoreToNextLevel = computed(() => 0)
  const badgesByCategory = computed(() => ({ ... }))

  // å·¥å…·æ–¹æ³•
  const getLevelColor = () => '#FF0000'
  const getLevelIcon = () => 'ğŸ‘¤'

  return { ... }
}
```

### ç”¨æˆ·èµ„æ–™é¡µé¢ï¼ˆUserProfile.vueï¼‰ç¤ºä¾‹

```vue
<template>
  <div class="user-profile">
    <!-- ç”¨æˆ·å¤´éƒ¨ -->
    <div class="profile-header">
      <div class="banner" :style="{ backgroundImage: `url(${user.banner})` }"></div>

      <div class="profile-info">
        <img :src="user.avatar" class="avatar" />
        <div class="user-basic">
          <h1>{{ user.username }}</h1>
          <p class="signature">{{ user.signature }}</p>
          <p class="bio">{{ user.bio }}</p>
        </div>

        <!-- æ“ä½œæŒ‰é’® -->
        <div class="actions" v-if="!isCurrentUser">
          <el-button
            :type="isFollowing ? 'info' : 'primary'"
            @click="toggleFollow"
          >
            {{ mutualText }}
          </el-button>
          <el-button>ç§ä¿¡</el-button>
        </div>
      </div>
    </div>

    <!-- ç»Ÿè®¡æ•°æ® -->
    <div class="stats-row">
      <stat-card label="å¸–å­" :value="stats.postsCount" />
      <stat-card label="è¯„è®º" :value="stats.commentsCount" />
      <stat-card label="è·èµ" :value="stats.likesCount" />
      <stat-card label="ç²‰ä¸" :value="stats.followers" />
      <stat-card label="å…³æ³¨" :value="stats.following" />
    </div>

    <!-- å£°èª‰é¢æ¿ -->
    <reputation-panel :reputation="reputation" />

    <!-- æ ‡ç­¾é¡µï¼šå¸–å­/è¯„è®º/æ”¶è— -->
    <el-tabs>
      <el-tab-pane label="å¸–å­">
        <post-list :posts="userPosts" />
      </el-tab-pane>
      <el-tab-pane label="è¯„è®º">
        <comment-list :comments="userComments" />
      </el-tab-pane>
      <el-tab-pane label="æ”¶è—">
        <collection-list :collections="userCollections" />
      </el-tab-pane>
    </el-tabs>
  </div>
</template>

<script setup>
import { onMounted } from 'vue'
import { useRoute } from 'vue-router'
import { useUserProfile } from '@/composables/useUserProfile'
import { useFollowSystem } from '@/composables/useFollowSystem'
import { useReputation } from '@/composables/useReputation'

const route = useRoute()
const userId = route.params.userId

// ç»„åˆæ‰€æœ‰ composables
const { user, stats, reputation, fetchUserProfile, fetchUserPosts, fetchUserComments } = useUserProfile(userId)
const { isFollowing, isMutual, mutualText, toggleFollow, initialize } = useFollowSystem(userId)

onMounted(async () => {
  await Promise.all([
    fetchUserProfile(),
    initialize(),
    fetchUserPosts(),
    fetchUserComments()
  ])
})
</script>
```

---

## æ•°æ®åº“è®¾è®¡

### æ ¸å¿ƒè¡¨ç»“æ„

#### users è¡¨

```sql
CREATE TABLE users (
  id VARCHAR(36) PRIMARY KEY,
  username VARCHAR(50) UNIQUE NOT NULL,
  email VARCHAR(100) UNIQUE,
  password_hash VARCHAR(255),
  avatar VARCHAR(255),
  banner VARCHAR(255),  -- èƒŒæ™¯å›¾
  signature VARCHAR(200),  -- ç­¾å
  bio TEXT,  -- ä¸ªäººä»‹ç»
  phone VARCHAR(20),
  location VARCHAR(100),

  -- ç»Ÿè®¡
  posts_count INT DEFAULT 0,
  comments_count INT DEFAULT 0,
  followers_count INT DEFAULT 0,
  following_count INT DEFAULT 0,

  -- è®¤è¯
  email_verified BOOLEAN DEFAULT false,
  phone_verified BOOLEAN DEFAULT false,

  -- çŠ¶æ€
  is_active BOOLEAN DEFAULT true,
  is_banned BOOLEAN DEFAULT false,

  -- æ—¶é—´
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  last_login_at TIMESTAMP,

  KEY idx_username (username),
  KEY idx_email (email),
  KEY idx_created_at (created_at)
);
```

#### follows è¡¨

```sql
CREATE TABLE follows (
  id VARCHAR(36) PRIMARY KEY,
  follower_id VARCHAR(36) NOT NULL,  -- ç²‰ä¸
  following_id VARCHAR(36) NOT NULL,  -- è¢«å…³æ³¨çš„äºº
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

  UNIQUE KEY unique_follow (follower_id, following_id),
  FOREIGN KEY (follower_id) REFERENCES users(id),
  FOREIGN KEY (following_id) REFERENCES users(id),
  KEY idx_following_id (following_id)
);
```

#### user_reputation è¡¨

```sql
CREATE TABLE user_reputation (
  id VARCHAR(36) PRIMARY KEY,
  user_id VARCHAR(36) UNIQUE NOT NULL,
  level INT DEFAULT 1,  -- 1-10
  score INT DEFAULT 0,  -- å½“å‰ç­‰çº§ç§¯åˆ†
  total_score INT DEFAULT 0,  -- ç´¯è®¡ç§¯åˆ†
  rank INT,  -- æ’å

  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

  FOREIGN KEY (user_id) REFERENCES users(id),
  KEY idx_level (level),
  KEY idx_score (score),
  KEY idx_rank (rank)
);
```

#### user_badges è¡¨

```sql
CREATE TABLE user_badges (
  id VARCHAR(36) PRIMARY KEY,
  user_id VARCHAR(36) NOT NULL,
  badge_id VARCHAR(50) NOT NULL,  -- å¾½ç«  ID
  earned_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

  UNIQUE KEY unique_badge (user_id, badge_id),
  FOREIGN KEY (user_id) REFERENCES users(id),
  KEY idx_user_id (user_id)
);
```

#### blocks è¡¨ï¼ˆå±è”½ç”¨æˆ·ï¼‰

```sql
CREATE TABLE blocks (
  id VARCHAR(36) PRIMARY KEY,
  blocker_id VARCHAR(36) NOT NULL,  -- å±è”½è€…
  blocked_id VARCHAR(36) NOT NULL,  -- è¢«å±è”½è€…
  reason VARCHAR(255),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

  UNIQUE KEY unique_block (blocker_id, blocked_id),
  FOREIGN KEY (blocker_id) REFERENCES users(id),
  FOREIGN KEY (blocked_id) REFERENCES users(id)
);
```

---

## æœ€ä½³å®è·µ

### 1. ç¼“å­˜ç­–ç•¥

```javascript
// ç”¨æˆ·èµ„æ–™ç¼“å­˜æ—¶é—´è¾ƒé•¿ï¼ˆ30 åˆ†é’Ÿï¼‰ï¼Œå› ä¸ºå˜åŒ–ä¸é¢‘ç¹
const CACHE_TIME = {
  USER_PROFILE: 30 * 60 * 1000,  // 30åˆ†é’Ÿ
  FOLLOW_STATUS: 10 * 60 * 1000,  // 10åˆ†é’Ÿ
  REPUTATION: 5 * 60 * 1000       // 5åˆ†é’Ÿ
}
```

### 2. å…³æ³¨çŠ¶æ€æ£€æŸ¥

```javascript
// ç”¨æˆ·æ‰“å¼€ä¸ªäººèµ„æ–™æ—¶ï¼Œç«‹å³æ£€æŸ¥å…³æ³¨çŠ¶æ€
onMounted(async () => {
  await Promise.all([
    fetchUserProfile(),
    checkFollowStatus()
  ])
})
```

### 3. å¤´åƒä¸Šä¼ 

```javascript
// ä½¿ç”¨ FormData ä¸Šä¼ æ–‡ä»¶
const uploadAvatar = async (file) => {
  const formData = new FormData()
  formData.append('file', file)

  // é™åˆ¶æ–‡ä»¶å¤§å°å’Œç±»å‹
  if (file.size > 5 * 1024 * 1024) {
    error.value = 'å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡ 5MB'
    return null
  }

  if (!['image/jpeg', 'image/png', 'image/webp'].includes(file.type)) {
    error.value = 'ä»…æ”¯æŒ JPEG, PNG, WebP æ ¼å¼'
    return null
  }

  return await communityAPI.uploadAvatar(formData)
}
```

### 4. æƒé™æ£€æŸ¥

```javascript
// æ£€æŸ¥æ˜¯å¦æ˜¯å½“å‰ç”¨æˆ·
const isCurrentUser = computed(() => {
  return currentUser.value?.id === userId
})

// è®¡ç®—æ˜¯å¦å¯ç¼–è¾‘
const editable = computed(() => isCurrentUser.value)
```

---

## åç«¯å®ç°ç¤ºä¾‹ï¼ˆJava/Springï¼‰

```java
@RestController
@RequestMapping("/api/community/users")
public class UserController {

    @GetMapping("/{userId}")
    public ResponseEntity<?> getUserProfile(@PathVariable String userId) {
        User user = userService.getUserProfile(userId);
        return ResponseEntity.ok(new ApiResponse(user));
    }

    @PutMapping("/{userId}")
    public ResponseEntity<?> updateUserProfile(
            @PathVariable String userId,
            @RequestBody UpdateUserRequest request) {
        User user = userService.updateUserProfile(userId, request);
        return ResponseEntity.ok(new ApiResponse(user));
    }

    @PostMapping("/{userId}/follow")
    public ResponseEntity<?> toggleFollow(@PathVariable String userId) {
        boolean isFollowing = followService.toggleFollow(getCurrentUserId(), userId);
        return ResponseEntity.ok(new ApiResponse(new FollowResponse(isFollowing)));
    }

    @GetMapping("/{userId}/followers")
    public ResponseEntity<?> getFollowers(
            @PathVariable String userId,
            @RequestParam int page,
            @RequestParam int pageSize) {
        List<User> followers = followService.getFollowers(userId, page, pageSize);
        int total = followService.countFollowers(userId);
        return ResponseEntity.ok(new ApiResponse(followers, total, page, pageSize));
    }

    @GetMapping("/{userId}/reputation")
    public ResponseEntity<?> getReputation(@PathVariable String userId) {
        UserReputation reputation = reputationService.getReputation(userId);
        return ResponseEntity.ok(new ApiResponse(reputation));
    }

    @PostMapping("/avatar")
    public ResponseEntity<?> uploadAvatar(@RequestParam("file") MultipartFile file) {
        String url = fileService.uploadAvatar(file);
        return ResponseEntity.ok(new ApiResponse(new UploadResponse(url)));
    }
}
```

---

## ç§¯åˆ†ç³»ç»Ÿç¤ºä¾‹

ç”¨æˆ·é€šè¿‡å„ç§æ“ä½œè·å¾—ç§¯åˆ†ï¼Œç§¯åˆ†å†³å®šç­‰çº§å’Œæ’åï¼š

| æ“ä½œ | ç§¯åˆ† | é¢‘ç‡é™åˆ¶ |
|-----|------|--------|
| å‘å¸ƒå¸–å­ | +10 | æ¯æ—¥ 5 æ¬¡ |
| å‘è¡¨è¯„è®º | +3 | æ— é™åˆ¶ |
| è·å¾—ç‚¹èµ | +1 | æ— é™åˆ¶ |
| å¸®åŠ©ä»–äºº | +15 | å®¡æ ¸é€šè¿‡ |
| åˆ†äº«çŸ¥è¯† | +20 | æœˆåº¦è¯„é€‰ |
| ä¸¾æŠ¥ä¸è‰¯å†…å®¹ | +5 | æ¯ä¸ªæœ‰æ•ˆä¸¾æŠ¥ |

---

## å¸¸è§é—®é¢˜

### Q: å¦‚ä½•é˜²æ­¢åˆ·ç²‰ä¸ï¼Ÿ

**A:**
1. æ£€æµ‹å¼‚å¸¸å…³æ³¨è¡Œä¸ºï¼ˆçŸ­æ—¶é—´å¤§é‡å…³æ³¨ï¼‰
2. å®ç°å…³æ³¨é—´éš”é™åˆ¶
3. å±è”½æœºå™¨äººè´¦æˆ·
4. å®šæœŸå®¡æŸ¥æ’è¡Œæ¦œå¼‚å¸¸è´¦æˆ·

### Q: å£°èª‰ç­‰çº§å¦‚ä½•é‡ç½®ï¼Ÿ

**A:** å£°èª‰ç­‰çº§é€šå¸¸ä¸é‡ç½®ï¼Œä½†åœ¨ä»¥ä¸‹æƒ…å†µä¸‹å¯èƒ½é™çº§ï¼š
1. ç”¨æˆ·è¿åç¤¾åŒºè§„åˆ™
2. è¢«ä¸¾æŠ¥å†…å®¹ç¡®è®¤è¿è§„
3. å¹¿å‘Š/åƒåœ¾å†…å®¹è¢«åˆ é™¤

### Q: å¦‚ä½•å¤„ç†è¢«å±è”½ç”¨æˆ·çš„å†…å®¹ï¼Ÿ

**A:**
1. å±è”½ç”¨æˆ·çš„å¸–å­/è¯„è®ºå¯¹å±è”½è€…ä¸å¯è§
2. å±è”½ç”¨æˆ·çš„å¤´åƒå’Œç­¾åä¸æ˜¾ç¤º
3. å±è”½å…³ç³»åœ¨åˆ—è¡¨ä¸­æ ‡è®°ä¸º"å·²å±è”½"

### Q: å¤´åƒä¸Šä¼ å¤§å°é™åˆ¶ï¼Ÿ

**A:**
- æ¨èå¤§å°ï¼š500x500px
- æœ€å¤§æ–‡ä»¶ï¼š5MB
- æ”¯æŒæ ¼å¼ï¼šJPEG, PNG, WebP
- è‡ªåŠ¨å‹ç¼©å’Œè£å‰ª

---

## æ–‡ä»¶æ¸…å•

### å‰ç«¯æ–‡ä»¶

```
frontend/src/
â”œâ”€â”€ composables/
â”‚   â”œâ”€â”€ useUserProfile.js        (320 è¡Œ)
â”‚   â”œâ”€â”€ useFollowSystem.js       (280 è¡Œ)
â”‚   â””â”€â”€ useReputation.js         (320 è¡Œ)
â”œâ”€â”€ views/community/
â”‚   â”œâ”€â”€ UserProfile.vue          (å¾…åˆ›å»º)
â”‚   â”œâ”€â”€ UserCenter.vue           (å¾…åˆ›å»º)
â”‚   â”œâ”€â”€ Leaderboard.vue          (å¾…åˆ›å»º)
â”‚   â””â”€â”€ components/
â”‚       â”œâ”€â”€ UserCard.vue         (å¾…åˆ›å»º)
â”‚       â”œâ”€â”€ ReputationPanel.vue  (å¾…åˆ›å»º)
â”‚       â””â”€â”€ LeaderboardCard.vue  (å¾…åˆ›å»º)
â””â”€â”€ api/
    â””â”€â”€ communityWithCache.js    (å·²æ›´æ–° with user methods)
```

---

**æ›´æ–°æ—¶é—´**ï¼š2025-11-11
**ç‰ˆæœ¬**ï¼š1.0
**çŠ¶æ€**ï¼šâœ… å‰ç«¯å®Œå…¨å®ç°ï¼Œå¾…åç«¯å¯¹æ¥
