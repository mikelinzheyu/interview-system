# Dockerç”Ÿäº§ç¯å¢ƒéƒ¨ç½²çŠ¶æ€æŠ¥å‘Š

**æŠ¥å‘Šæ—¶é—´ï¼š** 2025-10-26 22:25
**æ•´ä½“çŠ¶æ€ï¼š** âš ï¸ å¾…ç½‘ç»œè¿æ¥æ¢å¤

---

## ğŸ“‹ æ‰§è¡Œæ¦‚è§ˆ

### å®Œæˆçš„ä»»åŠ¡
- âœ… **Dockerå®¹å™¨æ¸…ç†** - å·²åœæ­¢å¹¶ç§»é™¤æ‰€æœ‰ç°æœ‰å®¹å™¨
- âœ… **é¡¹ç›®é›†æˆ** - å­˜å‚¨æœåŠ¡å·²å®Œå…¨é›†æˆåˆ°ä¸»é¡¹ç›®
- âœ… **Dockeré…ç½®ä¿®å¤** - è§£å†³äº†Docker Desktopå‡­è¯è¾…åŠ©ç¨‹åºé—®é¢˜
- âœ… **ç¯å¢ƒé…ç½®éªŒè¯** - .env.dockerå’Œdocker-compose.ymlå·²æ­£ç¡®é…ç½®
- âœ… **æ–‡ä»¶ç³»ç»Ÿå‡†å¤‡** - æ‰€æœ‰source codeå’ŒDockerfileå·²å‡†å¤‡å°±ç»ª

### å¾…å®Œæˆçš„ä»»åŠ¡
- â³ **Dockeré•œåƒæ„å»º** - å› Docker Hubç½‘ç»œè¿æ¥é—®é¢˜æš‚åœ
  - åç«¯é•œåƒï¼ˆNode.jsï¼‰
  - å‰ç«¯é•œåƒï¼ˆNginx + Vue3ï¼‰
  - å­˜å‚¨æœåŠ¡é•œåƒï¼ˆJava + Spring Bootï¼‰
  - Redisé•œåƒï¼ˆé€šè¿‡docker-compose pullï¼‰
- â³ **æœåŠ¡å¯åŠ¨** - ç­‰å¾…é•œåƒæ„å»ºå®Œæˆ
- â³ **å¥åº·æ£€æŸ¥** - éªŒè¯æ‰€æœ‰æœåŠ¡çŠ¶æ€
- â³ **ç”Ÿäº§ç¯å¢ƒæµ‹è¯•** - å…¨é¢åŠŸèƒ½æµ‹è¯•

---

## ğŸ”§ ç½‘ç»œé—®é¢˜è¯Šæ–­

### é—®é¢˜æè¿°
Docker Hub (auth.docker.io) ç›®å‰æ— æ³•è®¿é—®ã€‚ç³»ç»Ÿèƒ½å¤Ÿè§£æåŸŸåï¼Œä½†è¿æ¥è¶…æ—¶ã€‚

**é”™è¯¯ä¿¡æ¯ï¼š**
```
failed to authorize: failed to fetch anonymous token:
Get "https://auth.docker.io/token?scope=repository%3Alibrary%2Fnode%3Apull&service=registry.docker.io":
dial tcp [2a03:2880:f10d:183:face:b00c:0:25de]:443:
connectex: A connection attempt failed because the connected party did not properly respond
```

**åŸå› ï¼š** Docker HubæœåŠ¡å™¨æ— æ³•å“åº”ï¼ˆä¸´æ—¶ç½‘ç»œæ•…éšœæˆ–é˜²ç«å¢™é™åˆ¶ï¼‰

### è§£å†³æ–¹æ¡ˆ
1. **ç­‰å¾…ç½‘ç»œæ¢å¤** - ç¨åé‡è¯•æ„å»ºå‘½ä»¤
2. **ä½¿ç”¨é•œåƒç¼“å­˜** - å¦‚æœæœ‰æœ¬åœ°ç¼“å­˜é•œåƒï¼Œå¯ç›´æ¥ä½¿ç”¨
3. **é…ç½®ç§æœ‰é•œåƒåº“** - é…ç½®Aliyunæˆ–å…¶ä»–å›½å†…é•œåƒåŠ é€Ÿå™¨

---

## ğŸ—ï¸ å·²æ•´åˆçš„é¡¹ç›®ç»“æ„

### æ–°å¢çš„å­˜å‚¨æœåŠ¡ï¼ˆStorage Serviceï¼‰

```
storage-service/
â”œâ”€â”€ pom.xml                                       âœ… Mavenä¾èµ–é…ç½®
â”œâ”€â”€ Dockerfile                                     âœ… Dockeré•œåƒæ„å»º
â””â”€â”€ src/main/java/com/example/interviewstorage/
    â”œâ”€â”€ InterviewStorageApplication.java          âœ… Spring Bootå¯åŠ¨ç±»
    â”œâ”€â”€ config/
    â”‚   â”œâ”€â”€ ApiKeyAuthFilter.java                âœ… APIå¯†é’¥è®¤è¯
    â”‚   â”œâ”€â”€ RedisConfig.java                     âœ… Redisé…ç½®
    â”‚   â””â”€â”€ SecurityConfig.java                  âœ… å®‰å…¨é…ç½®
    â”œâ”€â”€ controller/
    â”‚   â””â”€â”€ SessionController.java               âœ… REST APIæ§åˆ¶å™¨
    â””â”€â”€ model/
        â”œâ”€â”€ QuestionData.java                    âœ… é—®é¢˜æ•°æ®æ¨¡å‹
        â””â”€â”€ SessionData.java                     âœ… ä¼šè¯æ•°æ®æ¨¡å‹
```

### Dockerå®¹å™¨ç¼–æ’

```yaml
services:
  backend (Node.js)           -> ç«¯å£ 8080
  frontend (Nginx + Vue3)     -> ç«¯å£ 80/443
  storage-service (Java)      -> ç«¯å£ 8081
  redis                       -> ç«¯å£ 6379

ç½‘ç»œ: interview-network (Bridge)
```

---

## ğŸ“Š éƒ¨ç½²é…ç½®æ¸…å•

| é…ç½®é¡¹ | çŠ¶æ€ | è¯¦æƒ… |
|--------|------|------|
| docker-compose.yml | âœ… | 4ä¸ªæœåŠ¡å·²å®šä¹‰ï¼Œä¾èµ–å…³ç³»å·²é…ç½® |
| .env.docker | âœ… | ç¯å¢ƒå˜é‡å·²é…ç½®ï¼ŒåŒ…æ‹¬å­˜å‚¨æœåŠ¡ |
| Dockerå‡­è¯ | âœ… | docker-credential-desktopé—®é¢˜å·²è§£å†³ |
| Dockerfile | âœ… | æ‰€æœ‰4ä¸ªæœåŠ¡Dockerfileå·²å‡†å¤‡ |
| æºä»£ç  | âœ… | æ‰€æœ‰æºæ–‡ä»¶å·²å¤åˆ¶åˆ°æ­£ç¡®ä½ç½® |

---

## ğŸš€ æ¢å¤éƒ¨ç½²çš„æ­¥éª¤

### ç¬¬1æ­¥ï¼šéªŒè¯ç½‘ç»œè¿æ¥
```bash
# æµ‹è¯•Docker Hubè¿æ¥
docker pull alpine

# æˆ–æµ‹è¯•é€šç”¨ç½‘ç»œ
ping docker.io
```

### ç¬¬2æ­¥ï¼šæ„å»ºDockeré•œåƒ
```bash
cd D:\code7\interview-system
docker-compose --env-file .env.docker build --no-cache
```

### ç¬¬3æ­¥ï¼šå¯åŠ¨æ‰€æœ‰æœåŠ¡
```bash
docker-compose --env-file .env.docker up -d
```

### ç¬¬4æ­¥ï¼šéªŒè¯æœåŠ¡çŠ¶æ€
```bash
docker-compose --env-file .env.docker ps
```

**é¢„æœŸè¾“å‡ºï¼š**
```
NAME                 STATUS              PORTS
interview-backend    Up (healthy)        0.0.0.0:8080->3001/tcp
interview-frontend   Up (healthy)        0.0.0.0:80->80/tcp, 0.0.0.0:443->443/tcp
interview-storage    Up (healthy)        0.0.0.0:8081->8081/tcp
interview-redis      Up (healthy)        0.0.0.0:6379->6379/tcp
```

### ç¬¬5æ­¥ï¼šæ‰§è¡Œå¥åº·æ£€æŸ¥
```bash
# åç«¯API
curl http://localhost:8080/api/health

# å­˜å‚¨æœåŠ¡
curl http://localhost:8081/api/sessions

# å‰ç«¯
curl http://localhost/health

# Redis
docker-compose exec redis redis-cli ping
```

---

## ğŸ“ å·²ä¿®å¤çš„é—®é¢˜

### é—®é¢˜1ï¼šDockerå‡­è¯è¾…åŠ©ç¨‹åºé”™è¯¯
**åŸå› ï¼š** `docker-credential-desktop` åœ¨PATHä¸­æ‰¾ä¸åˆ°
**è§£å†³ï¼š** ç¼–è¾‘ `~/.docker/config.json`ï¼Œç§»é™¤ `credsStore` é…ç½®
```json
{
  "auths": {},
  "currentContext": "desktop-linux"
}
```

### é—®é¢˜2ï¼šdocker-compose.ymlç‰ˆæœ¬è­¦å‘Š
**æè¿°ï¼š** `version: '3.8'` å·²è¿‡æ—¶
**å½±å“ï¼š** éè‡´å‘½è­¦å‘Šï¼Œç³»ç»Ÿä»å¯æ­£å¸¸è¿è¡Œ
**å»ºè®®ï¼š** ä¸‹æ¬¡æ›´æ–°æ—¶ä»docker-compose.ymlç§»é™¤versionå­—æ®µ

---

## âœ… éƒ¨ç½²å®Œæˆæ£€æŸ¥æ¸…å•

éƒ¨ç½²æˆåŠŸåï¼Œè¯·éªŒè¯ä»¥ä¸‹é¡¹ï¼š

### å®¹å™¨æ£€æŸ¥
- [ ] 4ä¸ªå®¹å™¨å…¨éƒ¨RunningçŠ¶æ€
- [ ] æ‰€æœ‰å®¹å™¨å¥åº·æ£€æŸ¥éƒ½é€šè¿‡(Healthy)
- [ ] æ— å®¹å™¨å¤„äºExitedçŠ¶æ€

### APIæ£€æŸ¥
- [ ] åç«¯API `/api/health` è¿”å›200 OK
- [ ] å­˜å‚¨æœåŠ¡ `/api/sessions` è¿”å›æ­£ç¡®å“åº”
- [ ] Redis `redis-cli ping` è¿”å›PONG

### å‰ç«¯æ£€æŸ¥
- [ ] è®¿é—® http://localhost æ˜¾ç¤ºä¸»é¡µ
- [ ] ç½‘é¡µå¯ä»¥æ­£å¸¸åŠ è½½
- [ ] å‰ç«¯æ—¥å¿—æ— é”™è¯¯

### é›†æˆæ£€æŸ¥
- [ ] åç«¯å¯ä»¥è®¿é—®å­˜å‚¨æœåŠ¡ (http://interview-storage:8081)
- [ ] åç«¯å¯ä»¥è®¿é—®Redis (interview-redis:6379)
- [ ] å­˜å‚¨æœåŠ¡å¯ä»¥è®¿é—®Redis
- [ ] å‰ç«¯å¯ä»¥æ­£å¸¸è°ƒç”¨åç«¯API

---

## ğŸ” ç”Ÿäº§ç¯å¢ƒå¿…åšäº‹é¡¹

1. **æ›´æ”¹JWTå¯†é’¥**
   ```bash
   ç¼–è¾‘ .env.docker
   JWT_SECRET=your-secure-key-here
   ```

2. **é…ç½®çœŸå®SSLè¯ä¹¦**
   - æ›¿æ¢ nginx/ssl/ ä¸­çš„è¯ä¹¦
   - æˆ–é…ç½®Let's Encryptè‡ªåŠ¨æ›´æ–°

3. **ä¿æŠ¤APIå¯†é’¥**
   - SESSION_STORAGE_API_KEY ä½¿ç”¨å¼ºå¯†é’¥
   - ä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç æ•æ„Ÿä¿¡æ¯

4. **å¯ç”¨RedisæŒä¹…åŒ–**
   - æ£€æŸ¥docker-compose.ymlä¸­Redisé…ç½®
   - ç¡®ä¿RDBå’ŒAOFéƒ½å¯ç”¨

5. **é…ç½®ç›‘æ§å‘Šè­¦**
   - ç›‘æ§å®¹å™¨å¥åº·çŠ¶æ€
   - è®¾ç½®æ—¥å¿—èšåˆå’Œå‘Šè­¦

---

## ğŸ“ æ•…éšœæ’æŸ¥æŒ‡å—

### å¦‚æœDocker Hubä»æ— æ³•è®¿é—®
1. **é…ç½®é•œåƒåŠ é€Ÿå™¨ï¼š**
   ```bash
   # ç¼–è¾‘ /etc/docker/daemon.json (Linux) æˆ–
   # Docker Desktop è®¾ç½® -> Docker Engine
   {
     "registry-mirrors": [
       "https://registry.aliyuncs.com",
       "https://docker.mirrors.ustc.edu.cn"
     ]
   }
   ```

2. **ä½¿ç”¨ç¦»çº¿é•œåƒï¼š**
   å¦‚æœæœ‰å†å²é•œåƒæ–‡ä»¶ï¼Œå¯ä»¥æ‰‹åŠ¨åŠ è½½ï¼š
   ```bash
   docker load -i interview-system-backend.tar
   docker load -i interview-system-frontend.tar
   ```

### å¦‚æœæ„å»ºå¤±è´¥
```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—
docker-compose logs -f

# æ¸…ç†Dockerç³»ç»Ÿå¹¶é‡è¯•
docker system prune -a
docker-compose build --no-cache
```

---

## ğŸ“Š ç³»ç»Ÿæ¶æ„ï¼ˆéƒ¨ç½²åï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Docker Host (localhost)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚      interview-network (Bridge)             â”‚   â”‚
â”‚  â”‚                                             â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚   â”‚
â”‚  â”‚  â”‚  Frontend     â”‚  â”‚  Backend     â”‚      â”‚   â”‚
â”‚  â”‚  â”‚  (Nginx)      â”‚  â”‚  (Node.js)   â”‚      â”‚   â”‚
â”‚  â”‚  â”‚  Port 80      â”‚  â”‚  Port 3001   â”‚      â”‚   â”‚
â”‚  â”‚  â”‚  Port 443     â”‚  â”‚  Port 8080   â”‚      â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚   â”‚
â”‚  â”‚         â”‚                  â”‚               â”‚   â”‚
â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚   â”‚
â”‚  â”‚                â”‚                           â”‚   â”‚
â”‚  â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚   â”‚
â”‚  â”‚         â”‚               â”‚                 â”‚   â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚   â”‚
â”‚  â”‚    â”‚  Storage   â”‚  â”‚    Redis     â”‚      â”‚   â”‚
â”‚  â”‚    â”‚  Service   â”‚  â”‚              â”‚      â”‚   â”‚
â”‚  â”‚    â”‚  (Java)    â”‚  â”‚  Port 6379   â”‚      â”‚   â”‚
â”‚  â”‚    â”‚  Port 8081 â”‚  â”‚  Port 6379   â”‚      â”‚   â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚   â”‚
â”‚  â”‚                                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ åç»­æ­¥éª¤

1. **ç­‰å¾…ç½‘ç»œæ¢å¤åç«‹å³æ‰§è¡Œï¼š**
   ```bash
   cd D:\code7\interview-system
   docker-compose --env-file .env.docker build
   docker-compose --env-file .env.docker up -d
   ```

2. **è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶**
3. **éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ**
4. **é…ç½®ç›‘æ§å’Œæ—¥å¿—èšåˆ**
5. **è®¾ç½®å¤‡ä»½ç­–ç•¥**

---

## ğŸ“ˆ é¢„æœŸå®Œæˆæ—¶é—´

- Dockeré•œåƒæ„å»ºï¼š**10-15åˆ†é’Ÿ** (ä¸€æ¬¡æ€§ï¼Œåç»­æ— éœ€é‡å¤)
- æœåŠ¡å¯åŠ¨ï¼š**2-3åˆ†é’Ÿ**
- å¥åº·æ£€æŸ¥é€šè¿‡ï¼š**1-2åˆ†é’Ÿ**
- å…¨é¢æµ‹è¯•ï¼š**5-10åˆ†é’Ÿ**

**æ€»è®¡ï¼š** çº¦**20-30åˆ†é’Ÿ**ï¼ˆç½‘ç»œæ¢å¤åï¼‰

---

## ğŸ“ ç›¸å…³æ–‡æ¡£

- `STORAGE_SERVICE_INTEGRATION_COMPLETE.md` - å­˜å‚¨æœåŠ¡é›†æˆè¯¦æƒ…
- `docker-compose.yml` - Dockerç¼–æ’é…ç½®
- `.env.docker` - ç¯å¢ƒå˜é‡é…ç½®
- `DOCKER_PRODUCTION_DEPLOYMENT.md` - ç”Ÿäº§éƒ¨ç½²æŒ‡å—

---

**æœ€åæ›´æ–°ï¼š** 2025-10-26 22:25 UTC+8
**éƒ¨ç½²çŠ¶æ€ï¼š** â³ ç­‰å¾…ç½‘ç»œè¿æ¥æ¢å¤
**é¢„è®¡æ¢å¤æ—¶é—´ï¼š** æ ¹æ®ç½‘ç»œæƒ…å†µè€Œå®š

ä¸€æ—¦ç½‘ç»œæ¢å¤ï¼ŒæŒ‰ç…§ä¸Šè¿°æ­¥éª¤æ‰§è¡Œæ„å»ºå’Œå¯åŠ¨å‘½ä»¤å³å¯å®Œæˆå…¨Dockerç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ã€‚

